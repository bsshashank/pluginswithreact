'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _indexBrowser=require('pouchdb/lib/index-browser');var _indexBrowser2=_interopRequireDefault(_indexBrowser);var _uuid=require('uuid');var _uuid2=_interopRequireDefault(_uuid);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}_indexBrowser2.default.plugin(require('pouchdb-find'));_indexBrowser2.default.plugin(require('pouchdb-quick-search'));/**
 * 
 * 
 * @class DocumentDatabase
 */var DocumentDatabase=function(){/**
   * Creates an instance of DocumentDatabase.
   * 
   * @param {any} dbName
   * @param {number} [dbVersion=1]
   */function DocumentDatabase(dbName){var dbVersion=arguments.length<=1||arguments[1]===undefined?1:arguments[1];_classCallCheck(this,DocumentDatabase);this.db=new _indexBrowser2.default(dbName+'.'+dbVersion,{adapter:'idb',storage:'persistent'})}/**
   * 
   * 
   * @param {any} doc
   * @returns
   */_createClass(DocumentDatabase,[{key:'save',value:function save(doc){var _this=this;if(!doc._id){doc._id=_uuid2.default.v4()}if(!doc.timestamp){doc.timestamp=new Date}var promise=Promise.resolve(this.db.get(doc._id).then(function(result){if(result.version===undefined||result.version!==doc.version){doc._rev=result._rev;return _this.db.put(doc)}return true}).catch(function(err){if(err.status==404){return _this.db.put(doc)}else{throw err}}));return promise}/**
   * 
   * 
   * @param {any} id
   * @returns
   */},{key:'get',value:function get(id){return this.db.get(id)}}]);return DocumentDatabase}();exports.default=DocumentDatabase;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRvY3VtZW50RGF0YWJhc2UuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJpa0JBQ0EsdUQseURBQ0EsMEIsMlFBRUEsdUJBQVEsTUFBUixDQUFlLFFBQVEsY0FBUixDQUFmLEVBQ0EsdUJBQVEsTUFBUixDQUFlLFFBQVEsc0JBQVIsQ0FBZixFQUVBOzs7O01BS00saUIsWUFFSjs7Ozs7S0FNQSwwQkFBWSxNQUFaLENBQW1DLElBQWYsVUFBZSwrQ0FBSCxDQUFHLHFEQUNqQyxLQUFLLEVBQUwsQ0FBVSwyQkFBZSxNQUFmLEtBQXlCLFNBQXpCLENBQXNDLENBQzlDLFFBQVMsS0FEcUMsQ0FFOUMsUUFBUyxZQUZxQyxDQUF0QyxDQUlYLENBRUQ7Ozs7O29FQU1LLEcsQ0FBSyxnQkFFUixHQUFJLENBQUMsSUFBSSxHQUFULENBQWMsQ0FDWixJQUFJLEdBQUosQ0FBVSxlQUFLLEVBQUwsRUFDWCxDQUVELEdBQUksQ0FBQyxJQUFJLFNBQVQsQ0FBb0IsQ0FDbEIsSUFBSSxTQUFKLENBQWdCLEdBQUksS0FDckIsQ0FFRCxHQUFJLFNBQVUsUUFBUSxPQUFSLENBQWdCLEtBQUssRUFBTCxDQUFRLEdBQVIsQ0FBWSxJQUFJLEdBQWhCLEVBQXFCLElBQXJCLENBQTBCLFNBQUMsTUFBRCxDQUFZLENBQ2xFLEdBQUssT0FBTyxPQUFQLEdBQW1CLFNBQXBCLEVBQW1DLE9BQU8sT0FBUCxHQUFtQixJQUFJLE9BQTlELENBQXdFLENBQ3RFLElBQUksSUFBSixDQUFXLE9BQU8sSUFBbEIsQ0FDQSxNQUFPLE9BQUssRUFBTCxDQUFRLEdBQVIsQ0FBWSxHQUFaLENBQ1IsQ0FDRCxNQUFPLEtBQ1IsQ0FONkIsRUFNM0IsS0FOMkIsQ0FNckIsU0FBQyxHQUFELENBQVMsQ0FDaEIsR0FBSSxJQUFJLE1BQUosRUFBYyxHQUFsQixDQUF1QixDQUNyQixNQUFPLE9BQUssRUFBTCxDQUFRLEdBQVIsQ0FBWSxHQUFaLENBQ1IsQ0FGRCxJQUVPLENBQ0wsS0FBTSxJQUNQLENBQ0YsQ0FaNkIsQ0FBaEIsQ0FBZCxDQWNBLE1BQU8sUUFDUixDQUVEOzs7OztxQ0FNSSxFLENBQUksQ0FDTixNQUFPLE1BQUssRUFBTCxDQUFRLEdBQVIsQ0FBWSxFQUFaLENBQ1IsQywrQ0FHWSxnQiIsImZpbGUiOiJEb2N1bWVudERhdGFiYXNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcbmltcG9ydCBQb3VjaERCIGZyb20gJ3BvdWNoZGIvbGliL2luZGV4LWJyb3dzZXInO1xuaW1wb3J0IHV1aWQgZnJvbSAndXVpZCc7XG5cblBvdWNoREIucGx1Z2luKHJlcXVpcmUoJ3BvdWNoZGItZmluZCcpKTtcblBvdWNoREIucGx1Z2luKHJlcXVpcmUoJ3BvdWNoZGItcXVpY2stc2VhcmNoJykpO1xuXG4vKipcbiAqIFxuICogXG4gKiBAY2xhc3MgRG9jdW1lbnREYXRhYmFzZVxuICovXG5jbGFzcyBEb2N1bWVudERhdGFiYXNlIHtcblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBEb2N1bWVudERhdGFiYXNlLlxuICAgKiBcbiAgICogQHBhcmFtIHthbnl9IGRiTmFtZVxuICAgKiBAcGFyYW0ge251bWJlcn0gW2RiVmVyc2lvbj0xXVxuICAgKi9cbiAgY29uc3RydWN0b3IoZGJOYW1lLCBkYlZlcnNpb24gPSAxKSB7XG4gICAgdGhpcy5kYiA9IG5ldyBQb3VjaERCKGAke2RiTmFtZX0uJHtkYlZlcnNpb259YCwge1xuICAgICAgYWRhcHRlcjogJ2lkYicsXG4gICAgICBzdG9yYWdlOiAncGVyc2lzdGVudCdcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBcbiAgICogXG4gICAqIEBwYXJhbSB7YW55fSBkb2NcbiAgICogQHJldHVybnNcbiAgICovXG4gIHNhdmUoZG9jKSB7XG5cbiAgICBpZiAoIWRvYy5faWQpIHtcbiAgICAgIGRvYy5faWQgPSB1dWlkLnY0KCk7XG4gICAgfVxuXG4gICAgaWYgKCFkb2MudGltZXN0YW1wKSB7XG4gICAgICBkb2MudGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICB9XG5cbiAgICB2YXIgcHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSh0aGlzLmRiLmdldChkb2MuX2lkKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgIGlmICgocmVzdWx0LnZlcnNpb24gPT09IHVuZGVmaW5lZCkgfHwgKHJlc3VsdC52ZXJzaW9uICE9PSBkb2MudmVyc2lvbikpIHtcbiAgICAgICAgZG9jLl9yZXYgPSByZXN1bHQuX3JldjtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIucHV0KGRvYyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBpZiAoZXJyLnN0YXR1cyA9PSA0MDQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIucHV0KGRvYyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgfSkpO1xuXG4gICAgcmV0dXJuIHByb21pc2U7XG4gIH1cblxuICAvKipcbiAgICogXG4gICAqIFxuICAgKiBAcGFyYW0ge2FueX0gaWRcbiAgICogQHJldHVybnNcbiAgICovXG4gIGdldChpZCkge1xuICAgIHJldHVybiB0aGlzLmRiLmdldChpZCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRG9jdW1lbnREYXRhYmFzZTtcbiJdfQ==